name: "Stale File"
description: "Stale File"
author: "kijimaD"
inputs:
  github_token:
    description: 'GitHub token(write + read)'
    required: true
  paths:
    description: 'Paths to be checked'
    required: false
    default: './'
  ignores:
    description: 'Paths to be ignored'
    required: false
    default: ''
  daysUntilStale:
    description: 'stale day'
    required: false
    default: 30
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - uses: ruby/setup-ruby@359bebbc29cbe6c87da6bc9ea3bc930432750108
      with:
        ruby-version: 3.1

    - name: check stale file
      id: check
      shell: bash
      run: |
        result=$(ruby ./src/main.rb)
        result="${result//$'\n'/'%0A'}" # https://github.community/t/set-output-truncates-multiline-strings/16852
        echo "::set-output name=stdout::$result"

    - name: Create an issue
      uses: actions-ecosystem/action-create-issue@v1
      with:
        github_token: ${{ inputs.GITHUB_TOKEN }}
        title: |
          today=$(date "+%Y-%m-%d")
          echo "üèúStaleFile | ${today}"
        body: |
          ${{ steps.check.outputs.stdout }}
        labels: |
          StaleFile

branding:
  icon: "chevron-up"
  color: "green"
